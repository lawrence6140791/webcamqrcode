<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­†é›» QR Code æƒæç«™</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        h1 { margin-bottom: 20px; }

        /* æƒæå™¨å®¹å™¨æ¨£å¼ */
        #reader {
            width: 600px; /* ç­†é›»è¢å¹•å¤§ï¼Œæˆ‘å€‘æŠŠæ¡†åšå¤§ä¸€é» */
            background-color: #000;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* æƒæçµæœå€åŸŸ */
        #result-container {
            margin-top: 20px;
            text-align: center;
            height: 50px;
        }

        .success-message {
            color: #2ecc71;
            font-size: 1.5rem;
            font-weight: bold;
            animation: fadeIn 0.5s;
        }

        /* éš±è—å‡½å¼åº«è‡ªå¸¶çš„ä¸€äº›ä¸å¿…è¦çš„é€£çµ */
        #reader__dashboard_section_csr span, 
        #reader__dashboard_section_swaplink {
            display: none !important;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <h1>ğŸ“· è«‹å‡ºç¤º QR Code å°æº–é¡é ­</h1>
    
    <div id="reader"></div>
    
    <div id="result-container">
        <span id="scan-result">ç­‰å¾…æƒæ...</span>
    </div>

    <audio id="scan-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>

    <script>
        // å–å¾—éŸ³æ•ˆå…ƒç´ 
        const audio = document.getElementById('scan-sound');
        
        // ç‚ºäº†é˜²æ­¢é‡è¤‡æƒæ (Debounce)ï¼Œè¨­å®šä¸€å€‹é–å®šç‹€æ…‹
        let isScanningLocked = false;

        function onScanSuccess(decodedText, decodedResult) {
            if (isScanningLocked) return; // å¦‚æœæ­£åœ¨è™•ç†ä¸Šä¸€æ¬¡çš„çµæœï¼Œå‰‡å¿½ç•¥

            // 1. æ’­æ”¾éŸ³æ•ˆ
            audio.play().catch(e => console.log("Audio play failed usually due to browser policy without interaction"));

            // 2. é–å®šæƒæï¼Œé¿å…åŒä¸€å¼µ QR Code ä¸€ç§’å…§è§¸ç™¼åæ¬¡
            isScanningLocked = true;

            // 3. é¡¯ç¤ºçµæœ
            const resultDiv = document.getElementById('scan-result');
            resultDiv.innerHTML = `âœ… æƒææˆåŠŸï¼š${decodedText}`;
            resultDiv.className = 'success-message';

            console.log(`æƒæåˆ°çš„æ•¸æ“š: ${decodedText}`);

            // 4. é€™è£¡å¯ä»¥åŠ å…¥å‚³é€è³‡æ–™åˆ°å¾Œç«¯çš„ç¨‹å¼ç¢¼ (ä¾‹å¦‚ fetch API)
            // sendToBackend(decodedText);

            // 5. è¨­å®š 3 ç§’å¾Œé‡ç½®ï¼Œæº–å‚™ä¸‹ä¸€æ¬¡æƒæ
            setTimeout(() => {
                resultDiv.innerHTML = "ç­‰å¾…æƒæ...";
                resultDiv.className = '';
                resultDiv.style.color = 'white';
                isScanningLocked = false;
            }, 3000);
        }

        // åˆå§‹åŒ–è¨­å®š
        let config = { 
            fps: 10, // æ¯ç§’åµæ¸¬å¹€æ•¸
            qrbox: { width: 300, height: 300 }, // æƒææ¡†å¤§å°
            aspectRatio: 1.0 
        };

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", 
            config, 
            /* verbose= */ false
        );
        
        html5QrcodeScanner.render(onScanSuccess);
    </script>
</body>
</html>